<div class="row mt-2">    
    <div class="col-12">

        <div class="mb-2">
            <app-header-page-title header-title="Movimentações Previstas" header-button-label="+ Nova Previsão"
                [header-button-link]="['/mov-prevista/new',dataIni | DateFormatToString, dataFim | DateFormatToString]">
            </app-header-page-title>
        </div>

        <p-panel header="Filtros" [toggleable]="true">
            <div class="d-flex justify-content-evenly mt-1">
                <span class="p-float-label p-input-icon-left">
                    <i class="pi pi-search"></i>
                    <input type="text" (input)="dt2.filterGlobal($event.target.value, 'contains')" id="inputtext-pesquisar" pInputText> 
                    <label for="inputtext-pesquisar">Pesquisar</label>
                </span>

                <span class="p-float-label">
                    <p-dropdown [options]="arCategorias"  optionLabel="descricao" optionValue="descricao"
                                [showClear]="true" [autoDisplayFirst]="false"
                                (onChange)="dt2.filterGlobal($event.value, 'contains')" inputId="dropdown">
                        <ng-template let-option pTemplate="item">
                            <span>{{option.descricao}}</span>
                        </ng-template>
                    </p-dropdown>
                    <label for="dropdown">Categoria</label>
                </span>
                 
                <span class="p-float-label">
                    <p-calendar inputId="calendar" 
                              [(ngModel)]="arDtRangeDataVenc" 
                              selectionMode="range" 
                              [readonlyInput]="true"
                              rangeSeparator="a"
                              showButtonBar="true"
                              dateFormat="dd/mm/yy">
                    </p-calendar>
                    <p-button icon="pi pi-search" styleClass="p-button-sm p-button-secondary" (click)="filtrarTablePorPeriodo()"></p-button>
                    <label for="calendar">Período do Vencimento</label>
                </span>
            </div>            
        </p-panel>
        
        <div class="card">
            <p-table #dt2 [value]="arMovPrevistas" dataKey="id" styleClass="p-datatable-sm" [rows]="10"
                [showCurrentPageReport]="true" [rowsPerPageOptions]="[10,25,50]" [loading]="boLoading"
                styleClass="p-datatable-customers" [paginator]="true"
                currentPageReportTemplate="Exibindo {first} até {last} de {totalRecords} registros"
                [globalFilterFields]="['itemMovimentacao.categoria.descricao',
                                          'itemMovimentacao.descricao',
                                          'formaPagamento.descricao',
                                          'statusDescricao',
                                          'parcela']">
                <ng-template pTemplate="header">
                    <tr class="font-size-small">
                        <th>Prioridade</th>
                        <th>Data de Vencimento</th>
                        <th>Item</th>
                        <th>Forma de Pagamento</th>
                        <th style="text-align: center;">Valor</th>
                        <th>Status</th>
                        <th>
                            <!--EDIÇÃO/EXCLUSÃO-->
                        </th>
                    </tr>
                    <tr class="font-size-small">
                        <th>
                            <!--PRIORIDADE-->
                            <p-columnFilter field="tipoPrioridade" matchMode="equals" [showMenu]="false">
                                <ng-template pTemplate="filter" let-value let-filter="filterCallback">
                                    <p-dropdown [ngModel]="value" [options]="arEnumPrioridades" optionLabel="Value"
                                        optionValue="Key" (onChange)="filter($event.value)" placeholder="Qualquer"
                                        [showClear]="true">
                                        <ng-template let-option pTemplate="item">
                                            <span>{{option.Value}}</span>
                                        </ng-template>
                                    </p-dropdown>
                                </ng-template>
                            </p-columnFilter>
                        </th>
                        <th pSortableColumn="dataVencimento" style="text-align: center;">
                            <!--DATA DE VENCIMENTO-->
                          <p-sortIcon field="dataVencimento"></p-sortIcon>
                        </th>
                        <th>
                            <!--ITEM MOVIMENTAÇÃO-->
                            <p-columnFilter field="itemMovimentacao" matchMode="in" [showMenu]="false">
                                <ng-template pTemplate="filter" let-value let-filter="filterCallback">
                                    <p-multiSelect [ngModel]="value" [options]="arItensMovimentacao"
                                        placeholder="Qualquer" (onChange)="filter($event.value)"
                                        optionLabel="descricao">
                                        <ng-template let-option pTemplate="item">
                                            <div class="p-multiselect-itemMovimentacao-option">
                                                <span class="p-ml-1">{{option.descricao}}</span>
                                            </div>
                                        </ng-template>
                                    </p-multiSelect>
                                </ng-template>
                            </p-columnFilter>
                        </th>
                        <th>
                            <!--FORMA DE PAGAMENTO-->
                            <p-columnFilter field="formaPagamento" matchMode="in" [showMenu]="false">
                                <ng-template pTemplate="filter" let-value let-filter="filterCallback">
                                    <p-multiSelect [ngModel]="value" [options]="arFormasPagamento" placeholder="Qualquer"
                                        (onChange)="filter($event.value)" optionLabel="descricao">
                                        <ng-template let-option pTemplate="item">
                                            <div class="p-multiselect-formaPagamento-option">
                                                <span class="p-ml-1">{{option.descricao}}</span>
                                            </div>
                                        </ng-template>
                                    </p-multiSelect>
                                </ng-template>
                            </p-columnFilter>
                        </th>
                        <th pSortableColumn="valor" style="text-align: center;">
                               <!--VALOR-->
                              <p-sortIcon field="valor"></p-sortIcon>
                        </th>
                        <th>
                            <!--STATUS-->
                            <p-columnFilter field="status" matchMode="equals" [showMenu]="false">
                                <ng-template pTemplate="filter" let-value let-filter="filterCallback">
                                    <p-dropdown [ngModel]="value" [options]="arEnumStatus" optionLabel="Value"
                                        optionValue="Key" (onChange)="filter($event.value)" placeholder="Qualquer"
                                        [showClear]="true">
                                        <ng-template let-option pTemplate="item">
                                            <span>{{option.Value}}</span>
                                        </ng-template>
                                    </p-dropdown>
                                </ng-template>
                            </p-columnFilter>
                        </th>
                        <th>
                            <!--EDIÇÃO/EXCLUSÃO-->
                        </th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-movimentacao>
                    <tr class="font-size-small">
                        <td>
                            <!--PRIORIDADE-->
                            <span *ngIf="movimentacao.tipoPrioridade=='A'">
                                <img class="logo" src="assets\icons\arrow_circle_up_black_24dp.svg"
                                    title="Prioridade: {{movimentacao.tipoPrioridadeDescricao}}" width="55" height="30">
                            </span>
                            <span *ngIf="movimentacao.tipoPrioridade=='M'">
                                <img class="logo" src="assets\icons\remove_circle_outline_black_24dp.svg"
                                    title="Prioridade: {{movimentacao.tipoPrioridadeDescricao}}" width="55" height="30">
                            </span>
                            <span *ngIf="movimentacao.tipoPrioridade=='B'">
                                <img class="logo" src="assets\icons\arrow_circle_down_black_24dp.svg"
                                    title="Prioridade: {{movimentacao.tipoPrioridadeDescricao}}" width="55" height="30">
                            </span>
                        </td>
                        <td style="text-align: center;">
                            <!--DATA DE VENCIMENTO-->
                            {{movimentacao.dataVencimento | date:'dd/MM/yyyy'}}
                        </td>
                        <td>
                            <!--ITEM-->
                            <strong>{{movimentacao.itemMovimentacao.descricao}}</strong>                            
                            <p>{{movimentacao.itemMovimentacao.categoria.descricao}}</p>
                        </td>
                        <td>
                            <!--FORMA DE PAGAMENTO-->
                            {{movimentacao.formaPagamento.descricao}}
                            <p *ngIf="movimentacao.parcela!='' ">Parcela: {{movimentacao.parcela}}</p>
                        </td>
                        <td class="text-end">
                            <!--VALOR-->
                            <strong [class.text-success]="movimentacao.itemMovimentacao.tipo=='R'"
                                [class.text-danger]="movimentacao.itemMovimentacao.tipo=='D'">
                                {{movimentacao.valor | currency}}
                            </strong>
                        </td>
                        <td>
                            <!--STATUS-->
                            <a *ngIf="movimentacao.status=='A'" 
                                [routerLink]="['/mov-prevista/quitar',movimentacao.itemMovimentacao.id, movimentacao.dataReferencia, dataIni | DateFormatToString, dataFim | DateFormatToString]" 
                                class="btn btn-outline-primary btn-sm">
                                Quitar
                            </a>
                            <img *ngIf="movimentacao.status=='Q'" class="logo text-start"
                                src="assets\icons\task_alt_black_24dp.svg"
                                title="Status: {{movimentacao.statusDescricao}}" width="55" height="30">
                        </td>
                        <td style="text-align: center;">
                            <!--EDIÇÃO/EXCLUSÃO-->
                            <a [routerLink]="['/mov-prevista/edit',movimentacao.itemMovimentacao.id, movimentacao.dataReferencia, dataIni | DateFormatToString, dataFim | DateFormatToString]" 
                               *ngIf="movimentacao.status!='Q'" class="btn btn-outline-info btn-sm me-3">
                                Editar
                            </a>
                            <button *ngIf="movimentacao.status!='Q' && movimentacao.parcela == ''" 
                                    class="btn btn-outline-danger btn-sm" 
                                    (click)="modalDeleteMessage(movimentacao.itemMovimentacao.id, movimentacao.dataReferencia)"
                                    data-bs-toggle="modal"
                                    data-bs-target="#modalDelete">
                                Excluir 
                            </button>
                        </td>
                    </tr>
                </ng-template>
                <ng-template pTemplate="emptymessage">
                    <tr>
                        <td colspan="5" class="font-size-small fw-bold">Movimentações Previstas não encontradas</td>
                    </tr>
                </ng-template>
            </p-table>
        </div>
    </div>
</div>

<app-modal-interrogative-form [modal-interrogative-id]="'modalDelete'" 
    [modal-interrogative-title]="'Sr. Usuário'"
    [modal-interrogative-message]="'Deseja realizar a exclusão?'" 
    (modalInterrogativeResponse)="eventDelete($event)">
</app-modal-interrogative-form>