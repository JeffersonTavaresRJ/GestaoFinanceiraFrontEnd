<!--TABELA DE RECORRÊNCIAS-->
<p-dialog [header]="headerDialog" [(visible)]="displayModal" [modal]="true" [style]="{width: '80vw'}"
    onHide="closeModal()" [resizable]="false" [maximizable]="true" appendTo="body" [id]="idModal">
    
    <p-table [value]="arMovRealizadas" dataKey="id" editMode="row" responsiveLayout="scroll">
        <ng-template pTemplate="header">
            <tr>
                <th>Data de Movimentação</th>
                <th>Conta</th>
                <th>Forma de Pagamento</th>
                <th>Valor</th>
                <th style="width:8rem"></th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-movPrevista let-editing="editing" let-ri="rowIndex">
            <tr [pEditableRow]="movRealizada">
                <td>
                    <p-cellEditor>
                        <ng-template pTemplate="input">
                            <p-inputMask [(ngModel)]="arStDataMovimentacao[ri]" mask="99/99/9999" slotChar=" ">
                            </p-inputMask>
                        </ng-template>
                        <ng-template pTemplate="output">
                            {{movRealizada.dataMovimentacaoRealizada | date: 'dd/MM/yyyy'}}                          
                        </ng-template>
                    </p-cellEditor>
                </td>

                <td>
                    <p-cellEditor>
                        <ng-template pTemplate="input">
                            <p-dropdown [options]="arContas" optionLabel="descricao" optionValue="id"
                                [(ngModel)]="movRealizada.conta.id" [style]="{'width':'100%'}"
                                emptyMessage="Conta não encontrada">
                            </p-dropdown>
                        </ng-template>
                        <ng-template pTemplate="output">
                            {{movRealizada.conta.descricao}}
                        </ng-template>
                    </p-cellEditor>
                </td>

                <td>
                    <p-cellEditor>
                        <ng-template pTemplate="input">
                            <p-dropdown [options]="arFormasPagamento" optionLabel="descricao" optionValue="id"
                                [(ngModel)]="movRealizada.formaPagamento.id" [style]="{'width':'100%'}"
                                emptyMessage="Forma de Pagamento não encontrada">
                            </p-dropdown>
                        </ng-template>
                        <ng-template pTemplate="output">
                            {{movRealizada.formaPagamento.descricao}}
                        </ng-template>
                    </p-cellEditor>
                </td>

                <td>
                    <p-cellEditor>
                        <ng-template pTemplate="input">
                            <p-inputNumber [(ngModel)]="arStValor[ri]" inputId="locale-german" mode="decimal"
                                locale="de-DE" [minFractionDigits]="2">
                            </p-inputNumber>
                        </ng-template>
                        <ng-template pTemplate="output">
                            {{movRealizada.valor | currency}}
                        </ng-template>
                    </p-cellEditor>
                </td>

                <td style="text-align:center">
                    <button *ngIf="!editing" pButton pRipple type="button" pInitEditableRow icon="pi pi-pencil"
                        (click)="onRowEditInit(movRealizada, ri)" class="p-button-rounded p-button-text"></button>
                    <button *ngIf="editing" pButton pRipple type="button" pSaveEditableRow icon="pi pi-check"
                        (click)="onRowEditSave(movRealizada, ri)"
                        class="p-button-rounded p-button-text p-button-success p-mr-2"></button>
                    <button *ngIf="editing" pButton pRipple type="button" pCancelEditableRow icon="pi pi-times"
                        (click)="onRowEditCancel(movRealizada, ri)"
                        class="p-button-rounded p-button-text p-button-danger"></button>
                </td>
            </tr>
        </ng-template>        
    </p-table>

    <ng-template pTemplate="footer">
        <div class="row">
            <div class="col-2" style="text-align: left;">
                <strong>Total: {{nrTotal | currency}}</strong>
            </div>
            <div class="col-8" style="text-align: center;">
                <p-inputNumber [(ngModel)]="nrTotalRecorrencias" [showButtons]="true" mode="decimal" [min]="2"
                       [max]="12" [size]="1" (onInput)="addRow()">
                </p-inputNumber>
            </div>
            <div class="col-2">
                <button class="btn btn-dark" (click)="post(arMovPrevistas)">
                    <img src="assets//icons//save-white-18dp.svg" class="v-middle" />
                    <span class="v-middle">Salvar</span>
                </button>
            </div>
        </div>
    </ng-template>
</p-dialog>

<!--DIALOG DE ERROS-->
<p-dialog [modal]="true" [(visible)]="displayError" [style]="{width: '50vw'}">
    <ng-template pTemplate="header">
        <div style="text-align: left;">
            <img class="logo" src="assets\icons\report_problem_black_24dp.svg" width="55" height="30">
            <strong>Erros de Validação</strong>
        </div>
    </ng-template>

    <ul>
        <li *ngFor="let error of arvalidationErrors" class="text-danger">
            <strong>{{ error.errors }}</strong>
        </li>
    </ul>

    <ng-template pTemplate="footer">
        <p-button icon="pi pi-check" (click)="clearValidations()" label="Ok" styleClass="p-button-text"></p-button>
    </ng-template>
</p-dialog>